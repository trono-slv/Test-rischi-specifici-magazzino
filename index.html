<!DOCTYPE html>
<html lang="it" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöõ DVR Magazziniere Completo 52 Rischi | Dott. Salvatore Trono</title>
    <meta name="description" content="Dott. Salvatore Trono - Laureato Scienze dei Servizi Giuridici. DVR Completo 52 Rischi Magazzino D.Lgs. 81/2008 con Matrice R/P/D, INAIL, Normative complete.">
    <meta name="author" content="Dott. Salvatore Trono">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    animation: { 'fade-in-up': 'fadeInUp 0.8s ease-out forwards' },
                    colors: {
                        primary: { 50: '#eff6ff', 500: '#3b82f6', 900: '#1e3a8a' }
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .glass-panel { 
            backdrop-filter: blur(20px); 
            background: rgba(17, 24, 39, 0.95); 
            border: 1px solid rgba(51, 65, 85, 0.5); 
        }
        .gradient-hero { 
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 50%, #1e1b4b 100%); 
        }
        .shadow-pro { 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6); 
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .risk-card { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            border-left: 4px solid transparent; 
        }
        .risk-card:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4); 
            border-left-color: #3b82f6; 
        }
        .matrix-crit { background: linear-gradient(135deg, #dc2626, #b91c1c); }
        .matrix-alta { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .matrix-media { background: linear-gradient(135deg, #eab308, #ca8a04); }
        .matrix-bassa { background: linear-gradient(135deg, #10b981, #059669); }
        @media (max-width: 768px) {
            .mobile-toolbar { position: fixed; bottom: 0; left: 0; right: 0; z-index: 50; }
        }
    </style>
</head>
<body class="bg-gradient-hero min-h-screen text-white">
    <!-- HEADER PROFESSIONALE -->
    <header class="glass-panel sticky top-0 z-50 shadow-pro border-b-2 border-indigo-500/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center py-4 md:py-6">
                <div class="flex items-center space-x-3 mb-4 md:mb-0">
                    <div class="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                        <span class="text-xl font-bold">üöõ</span>
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-black bg-gradient-to-r from-white to-gray-200 bg-clip-text text-transparent">
                            DVR Magazziniere
                        </h1>
                        <p class="text-sm md:text-base text-indigo-300 font-medium">
                            Dott. Salvatore Trono - Laureato Scienze dei Servizi Giuridici
                        </p>
                    </div>
                </div>
                <div class="flex items-center space-x-2 md:space-x-4">
                    <button onclick="toggleTheme()" aria-label="Toggle tema" class="p-2 rounded-xl glass-panel hover:bg-gray-700 transition-all">
                        <span class="dark:hidden">üåô</span>
                        <span class="dark:inline">‚òÄÔ∏è</span>
                    </button>
                    <button onclick="exportPDF()" aria-label="Esporta PDF" class="px-6 py-2.5 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all">
                        üìÑ PDF Completo
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
        <!-- PRESENTAZIONE E DISCLAIMER -->
        <section class="text-center mb-16 animate-fadeInUp">
            <div class="glass-panel p-8 md:p-12 rounded-3xl shadow-pro max-w-4xl mx-auto mb-12">
                <h2 class="text-4xl md:text-5xl font-black mb-6 bg-gradient-to-r from-white via-blue-100 to-indigo-200 bg-clip-text text-transparent">
                    Analisi Completa 52 Rischi Magazzino
                </h2>
                <p class="text-xl md:text-2xl text-gray-200 mb-8 leading-relaxed">
                    Valutazione dei Rischi Aziendali D.Lgs. 81/2008<br>
                    <span class="text-indigo-300 font-semibold">Magazzino Merci Generali - Laureato SPP Dott. Salvatore Trono</span>
                </p>
            </div>

            <!-- DISCLAIMER LEGALE -->
            <section class="glass-panel p-6 md:p-8 rounded-2xl shadow-pro mb-12 max-w-4xl mx-auto">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-amber-500/20 border-4 border-amber-500 rounded-3xl flex items-center justify-center mx-auto mb-4">
                        ‚ö†Ô∏è
                    </div>
                    <h3 class="text-2xl font-bold mb-4 text-amber-300">DISCLAIMER LEGALE</h3>
                </div>
                <div class="text-sm md:text-base text-gray-300 space-y-3 leading-relaxed">
                    <p>Il presente DVR √® uno <strong>strumento di supporto tecnico</strong> per la valutazione preliminare dei rischi.</p>
                    <p><strong>Non sostituisce la valutazione specifica aziendale</strong> obbligatoria ai sensi dell'art. 28 D.Lgs. 81/2008 da parte del Servizio di Prevenzione e Protezione (SPP).</p>
                    <p><strong>Dott. Salvatore Trono declina ogni responsabilit√†</strong> per applicazioni scorrette, omissioni di analisi site-specific o mancata personalizzazione.</p>
                    <p class="font-semibold text-amber-200">Il datore di lavoro deve verificare e integrare con sopralluogo tecnico.</p>
                </div>
            </section>
        </section>

        <!-- CATEGORIE RISCHI (8 ESATTE) -->
        <div id="categories-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-16"></div>

        <!-- TEST INTERATTIVO -->
        <section id="test-section" class="glass-panel p-8 md:p-12 rounded-3xl shadow-pro hidden mb-16">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-black mb-4">üß† Test Conoscenze DVR Magazzino</h2>
                <p class="text-xl text-gray-300">20 domande - 70% per PASSARE - Certificato scaricabile</p>
                <div class="flex justify-center space-x-4 mt-6">
                    <button onclick="startTest()" class="px-8 py-3 bg-green-500 hover:bg-green-600 rounded-xl font-semibold shadow-lg">üöÄ Inizia Test</button>
                    <button onclick="closeTest()" class="px-8 py-3 bg-gray-600 hover:bg-gray-700 rounded-xl font-semibold shadow-lg">‚ùå Chiudi</button>
                </div>
            </div>
            <div id="quiz-container"></div>
        </section>

        <!-- RISULTATI TEST -->
        <section id="results-section" class="glass-panel p-8 md:p-12 rounded-3xl shadow-pro hidden">
            <div class="text-center">
                <div id="results-badge" class="inline-block p-8 rounded-3xl mb-8 shadow-2xl"></div>
                <h2 id="results-title" class="text-3xl font-black mb-4"></h2>
                <p id="results-score" class="text-5xl font-black mb-8"></p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="exportCertificate()" class="px-8 py-4 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 rounded-2xl font-bold shadow-xl text-lg">üèÜ CERTIFICATO PDF</button>
                    <button onclick="closeTest()" class="px-8 py-4 bg-gray-600 hover:bg-gray-700 rounded-2xl font-bold shadow-lg text-lg">üîÑ Nuovo Test</button>
                </div>
            </div>
        </section>
    </main>

    <!-- MOBILE TOOLBAR -->
    <div class="md:hidden mobile-toolbar glass-panel p-4 border-t-2 border-indigo-500/50">
        <div class="flex justify-around items-center">
            <button onclick="startTest()" class="flex flex-col items-center space-y-1 p-2 rounded-xl hover:bg-gray-700" aria-label="Test">
                <span class="text-xl">üß†</span>
                <span class="text-xs font-medium">TEST</span>
            </button>
            <button onclick="exportPDF()" class="flex flex-col items-center space-y-1 p-2 rounded-xl hover:bg-gray-700" aria-label="PDF">
                <span class="text-xl">üìÑ</span>
                <span class="text-xs font-medium">PDF</span>
            </button>
            <button onclick="scrollToTop()" class="flex flex-col items-center space-y-1 p-2 rounded-xl hover:bg-gray-700" aria-label="Home">
                <span class="text-xl">üè†</span>
                <span class="text-xs font-medium">HOME</span>
            </button>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="glass-panel mt-24 p-8 md:p-12 text-center border-t-2 border-indigo-500/50">
        <div class="max-w-4xl mx-auto">
            <p class="text-lg font-semibold mb-4 text-indigo-300">¬© 2024 Dott. Salvatore Trono</p>
            <p class="text-sm text-gray-400 mb-4">Laureato in Scienze dei Servizi Giuridici | Consulente SPP D.Lgs. 81/2008</p>
            <p class="text-xs text-gray-500">Riferimenti normativi: D.Lgs. 81/2008, UNI EN ISO 45001, INAIL DVR Magazzini</p>
        </div>
    </footer>

    <script>
        // === DATABASE COMPLETO 52 RISCHI ===
        const RISKS_DB = {
            1: {
                title: "üîß RISCHI MECCANICI", count: 8,
                risks: [
                    {id:"RM1", title:"Schiacciamento transpallet", matrix:"CRITICA", r:5,p:5,d:5, cause:"Carico instabile >1500kg", danno:"Amputazione INAIL 180gg", prevenzione:"Formazione R.F.", protezione:"Scarpe S3 SRC", normativa:"D.Lgs.81/08 Tit.VI"},
                    {id:"RM2", title:"Taglio nastri metallici", matrix:"ALTA", r:4,p:5,d:4, cause:"Lame non protette", danno:"Sezione digitale T5", prevenzione:"Porta-lame automatica", protezione:"Guanti cut5 5.14", normativa:"UNI EN 388"},
                    {id:"RM3", title:"Caduta da scale magazzino", matrix:"CRITICA", r:5,p:4,d:5, cause:"Scala non EN131", danno:"Frattura vertebrale", prevenzione:"Piattaforme fisse", protezione:"Imbracatura 140kg", normativa:"D.Lgs.81/08 Tit.IV"},
                    {id:"RM4", title:"Intrappolamento nastri trasportatori", matrix:"ALTA", r:4,p:4,d:5, cause:"No protezioni fisse", danno:"Schiacciamento torace", prevenzione:"Barriere IP67", protezione:"--, normativa:"UNI EN 620"},
                    {id:"RM5", title:"Proiezione imballaggi rotti", matrix:"MEDIA", r:3,p:5,d:4, cause:"Legno scheggiato", danno:"Perforazione occhio", prevenzione:"Occhiali panoramica", protezione:"Polizza RC", normativa:"D.Lgs.81/08 Tit.III"},
                    {id:"RM6", title:"Schiacciamento porte sezionali", matrix:"MEDIA", r:3,p:4,d:4, cause:"Cavi usurati", danno:"Trauma cranico", prevenzione:"Fotocellule 2 vie", protezione:"Casco classe B", normativa:"UNI EN 13241"},
                    {id:"RM7", title:"Contusioni picking manuale", matrix:"BASSA", r:2,p:5,d:3, cause:"Scaffali alti 6m", danno:"Distorsione polso", prevenzione:"Carrelli retrattili", protezione:"Ginocchiere", normativa:"ISO 11228-2"},
                    {id:"RM8", title:"Vibrazioni transpallet", matrix:"MEDIA", r:3,p:3,d:4, cause:"Pavimento irregolare", danno:"Sindrome mano vibraz.", prevenzione:"Transpallet gommati", protezione:"Guanti antivibrazione", normativa:"D.Lgs.81/08 Tit.VIII"}
                ]
            },
            2: {
                title: "üßç‚Äç‚ôÇÔ∏è RISCHI POSTURALI/MMC", count: 7,
                risks: [
                    {id:"RP1", title:"Sollevamento carichi >25kg", matrix:"CRITICA", r:5,p:5,d:5, cause:"No muletti <1,8m", danno:"Ernia L4-L5 180gg INAIL", prevenzione:"Formazione ISO 11228", protezione:"Corsetto lombare", normativa:"D.Lgs.81/08 Tit.VI"},
                    {id:"RP2", title:"Ripetute flessioni tronco 8h", matrix:"ALTA", r:4,p:5,d:4, cause:"Picking da terra", danno:"Lombosciatalgia cronica", prevenzione:"Scaffali ergonomici 0,8m", protezione:"Scarpe ammortizzate", normativa:"UNI EN 1005-2"},
                    {id:"RP3", title:"Sollevamenti sopra spalla", matrix:"ALTA", r:4,p:4,d:4, cause:"Scaffali alti 2,2m", danno:"Tendinopatia cuffia rot.", prevenzione:"Pedane regolabili", protezione:"Bracciali elastici", normativa:"NIOSH lifting eq."},
                    {id:"RP4", title:"Movimenti asimmetrici torsione", matrix:"MEDIA", r:3,p:5,d:4, cause:"Corsie strette 1,2m", danno:"Pubalgia", prevenzione:"Specchi convessi angoli", protezione:"--, normativa:"OCRA metodo"},
                    {id:"RP5", title:"Permanenza in piedi 8h", matrix:"MEDIA", r:3,p:4,d:3, cause:"No stazioni sedute", danno:"Varici flebiti", prevenzione:"Tappeti antistanchezza", protezione:"Calze 15-20mmHg", normativa:"ISO 11226"},
                    {id:"RP6", title:"Microtraumi ripetuti picking", matrix:"ALTA", r:4,p:4,d:4, cause:"1000 cicli/giorno", danno:"Sindrome tunnel carpale", prevenzione:"Utensili ergonomici", protezione:"Polso rigido", normativa:"OCRA checklist"},
                    {id:"RP7", title:"Sforzo braccia sopra spalla", matrix:"MEDIA", r:3,p:4,d:4, cause:"Comandi plafoniere", danno:"Epicondilite", prevenzione:"Comandi a parete 1,6m", protezione:"Bracciale tennis elbow", normativa:"RULA metodo"}
                ]
            },
            3: {
                title: "‚ò£Ô∏è RISCHI CHIMICI/BIOLOGICI", count: 7,
                risks: [
                    {id:"RC1", title:"Polveri legno duro IARC2B", matrix:"ALTA", r:4,p:4,d:4, cause:"Taglio pannelli truciolari", danno:"Adenocarcinoma nasale", prevenzione:"Aspirazione 2m/s", protezione:"FFP3 + occhiali", normativa:"D.Lgs.81/08 Tit.IX"},
                    {id:"RC2", title:"Gas scarico carrelli GPL", matrix:"MEDIA", r:3,p:5,d:4, cause:"Ventilazione <6 ricambi/h", danno:"CO intossicazione acuta", prevenzione:"Rivelatori CO 30ppm", protezione:"Semimaschera A1", normativa:"D.Lgs.50/2024"},
                    {id:"RC3", title:"Impregnanti formaldeide H330", matrix:"CRITICA", r:5,p:4,d:5, cause:"Pallets UMIFIBRE", danno:"Carcinogeno confermato", prevenzione:"Manipolazione guanti", protezione:"FFP2 + nitrile", normativa:"REACH 1907/06"},
                    {id:"RC4", title:"Batteri legionella celle frigo", matrix:"ALTA", r:4,p:3,d:5, cause:"Condensatori non puliti", danno:"Polmonite legionellosi", prevenzione:"Trattamento biocida", protezione:"FFP2", normativa:"Linee guida ISS"},
                    {id:"RC5", title:"Amianto crrisotilo tubi idraulici", matrix:"CRITICA", r:5,p:3,d:5, cause:"Manutenzione caldaie", danno:"Mesotelioma pleura", prevenzione:"Divieto manipolazione", protezione:"Vietato", normativa:"D.M. 20/08/1999"},
                    {id:"RC6", title:"Solventi spray verniciatura", matrix:"MEDIA", r:3,p:4,d:4, cause:"No cabina aspirante", danno:"Narcosi solventi", prevenzione:"Cabina classe II", protezione:"A2P3", normativa:"D.Lgs.81/08 Allegato XLVI"},
                    {id:"RC7", title:"Micotossine cereali muffe", matrix:"MEDIA", r:3,p:3,d:4, cause:"Big bags aperti umidi", danno:"Aflatossina epatotossica", prevenzione:"Umidit√† <13%", protezione:"FFP2", normativa:"Reg. CE 1881/2006"}
                ]
            },
            4: {
                title: "üå°Ô∏è RISCHI AMBIENTALI", count: 6,
                risks: [
                    {id:"RA1", title:"Rumore carrelli elevatori 88dB", matrix:"ALTA", r:4,p:5,d:4, cause:"Muflatori usurati", danno:"IPOACUSI bilaterale", prevenzione:"Muflatori nuovi", protezione:"Otoprotectors SNR35", normativa:"D.Lgs.81/08 Tit.VIII"},
                    {id:"RA2", title:"Illuminamento scaffali <200lux", matrix:"MEDIA", r:3,p:4,d:3, cause:"Lampade fluorescenti vecchie", danno:"Errori picking 15%", prevenzione:"LED 500lux", protezione:"--, normativa:"UNI EN 12464-1"},
                    {id:"RA3", title:"Polvere PM10 magazzino >100Œºg", matrix:"MEDIA", r:3,p:4,d:4, cause:"Carrelli senza filtro", danno:"BPCO cronica", prevenzione:"HEPA H14", protezione:"FFP2", normativa:"D.Lgs.155/2010"},
                    {id:"RA4", title:"Vibrazioni WBV carrelli 1.4m/s¬≤", matrix:"ALTA", r:4,p:4,d:4, cause:"Sedile rigido", danno:"Lombalgia cronica", prevenzione:"Sedile pneumatico", protezione:"Cuscino gel", normativa:"ISO 2631-1"},
                    {id:"RA5", title:"Campi magnetici carrelli 50Hz", matrix:"BASSA", r:2,p:3,d:3, cause:"Motori elettrici", danno:"Leucemia incerta", prevenzione:"Distanza 1m", protezione:"--, normativa:"D.Lgs.81/08 Tit.VIII"},
                    {id:"RA6", title:"Radiazioni UV lampade sodio", matrix:"BASSA", r:2,p:4,d:3, cause:"Lampade esterne rotte", danno:"Coniuttivite", prevenzione:"Protezioni vetro", protezione:"Occhiali UV400", normativa:"ICNIRP 2013"}
                ]
            },
            5: {
                title: "üöú RISCHI CARRELLI", count: 7,
                risks: [
                    {id:"RCa1", title:"Ribaltamento carrelli frontali", matrix:"CRITICA", r:5,p:4,d:5, cause:"Carico alto baricentro", danno:"Morte schiacciamento", prevenzione:"Carrelli stabilizzatori", protezione:"Roll-bar cabina", normativa:"D.Lgs.81/08 Alleg.V"},
                    {id:"RCa2", title:"Schiacciamento pedoni", matrix:"CRITICA", r:5,p:5,d:5, cause:"Corsie <3m", danno:"Trauma toracico letale", prevenzione:"Pedane con separatore", protezione:"Gilet alta visibilit√†", normativa:"UNI EN ISO 3691-1"},
                    {id:"RCa3", title:"Caduta carico carrelli", matrix:"ALTA", r:4,p:5,d:4, cause:"Forche usurate", danno:"Contusioni multiple", prevenzione:"Controllo forche mensile", protezione:"Casco classe E", normativa:"Direttiva macchine"},
                    {id:"RCa4", title:"Tamponamento retromarcia", matrix:"ALTA", r:4,p:4,d:4, cause:"No sonar retrocamera", danno:"Frattura vertebrale", prevenzione:"Telecamera + allarme 82dB", protezione:"--, normativa:"UNI EN 12016"},
                    {id:"RCa5", title:"Rottura catena sollevamento", matrix:"CRITICA", r:5,p:3,d:5, cause:"Manutenzione 12 mesi", danno:"Caduta carico 2000kg", prevenzione:"Controllo catena 6 mesi", protezione:"Rete anticaduta", normativa:"ISO 3691-4"},
                    {id:"RCa6", title:"Fughe idrauliche HP", matrix:"MEDIA", r:3,p:4,d:4, cause:"Guarnizioni vecchie", danno:"Iniezione oleodinamica", prevenzione:"Ispezione visiva giornaliera", protezione:"Guanti antinfortunistica", normativa:"UNI EN 982"},
                    {id:"RCa7", title:"Fuoco GPL carrelli", matrix:"ALTA", r:4,p:3,d:5, cause:"Bombola difettosa", danno:"Ustioni 3¬∞ grado", prevenzione:"Manometro GPL + estintore", protezione:"ABBigliamento FR", normativa:"D.Lgs.81/08 Tit.I"}
                ]
            },
            6: {
                title: "üî• RISCHI INCENDIO", count: 6,
                risks: [
                    {id:"RI1", title:"Fumo sigarette aree stoccaggio", matrix:"ALTA", r:4,p:4,d:5, cause:"No segnaletica chiara", danno:"Incendio pallet 10.000‚Ç¨", prevenzione:"Telecamere fumo + cartelli", protezione:"Estintore 6kg", normativa:"D.M. 10/03/98"},
                    {id:"RI2", title:"Corto circuito quadri elettrici", matrix:"CRITICA", r:5,p:3,d:5, cause:"Surriscaldamento 70¬∞C", danno:"Incendio totale magazzino", prevenzione:"Termocamere IR", protezione:"SCBA 30min", normativa:"CEI EN 61439"},
                    {id:"RI3", title:"Polveri combustibili legno", matrix:"ALTA", r:4,p:4,d:5, cause:"ATEX zona 22", danno:"Esplosione secondaria", prevenzione:"Aspirazione ATEX", protezione:"--, normativa:"D.Lgs.81/08 Tit.XI"},
                    {id:"RI4", title:"GPL carrelli perdite", matrix:"CRITICA", r:5,p:4,d:5, cause:"Raccordi valvole", danno:"Nube esplosiva 4.4%", prevenzione:"Rilevatori GPL 1000ppm", protezione:"Maschera EEBD", normativa:"UNI EN 50194"},
                    {id:"RI5", title:"Surriscaldamento compressori", matrix:"MEDIA", r:3,p:4,d:4, cause:"Filtro aria ostruito", danno:"Incendio olio lubrificante", prevenzione:"Manometri pressione", protezione:"Estintore CO2", normativa:"API 618"},
                    {id:"RI6", title:"Materiali infiammabili stocaggio", matrix:"ALTA", r:4,p:3,d:5, cause:"Vernici spray classe H", danno:"Fuoco rapido propagazione", prevenzione:"Gabbie ignifughe", protezione:"--, normativa:"D.M. 27/07/15"}
                ]
            },
            7: {
                title: "üå°Ô∏è RISCHI MICROCLIMA", count: 6,
                risks: [
                    {id:"MC1", title:"Stress termico caldo WBGT>28¬∞C", matrix:"ALTA", r:4,p:5,d:4, cause:"Estate T>32¬∞C U>70%", danno:"Colpo calore INAIL 28gg", prevenzione:"WBGT monitor + pause 15min/h", protezione:"Abbigliamento DRITECH", normativa:"D.Lgs.81/08 Tit.XLI"},
                    {id:"MC2", title:"Stress termico freddo <10¬∞C", matrix:"MEDIA", r:3,p:4,d:4, cause:"Celle frigo 0¬∞C>4h", danno:"Ipotermia", prevenzione:"Rotazione turni 2h", protezione:"3 layer termico", normativa:"UNI EN 14058"},
                    {id:"MC3", title:"Umidit√† relativa >80%", matrix:"MEDIA", r:3,p:5,d:3, cause:"No deumidificatori", danno:"Micotossine polmonari", prevenzione:"Deumidificatori 60%UR", protezione:"Calze traspiranti", normativa:"UNI 10339"},
                    {id:"MC4", title:"Velocit√† aria <0.1m/s", matrix:"BASSA", r:2,p:4,d:3, cause:"Ventilazione insufficiente", danno:"Sonno, cali attenzione", prevenzione:"Ventilatori 0.2m/s", protezione:"--", normativa:"UNI EN ISO 7730"},
                    {id:"MC5", title:"Radiazione termica celle", matrix:"MEDIA", r:3,p:3,d:4, cause:"Pannelli sandwich conduttivi", danno:"Disidratazione 2L/h", prevenzione:"Sensori IR", protezione:"Cappello riflettente", normativa:"ISO 7243"},
                    {id:"MC6", title:"Variazioni rapide temperatura", matrix:"ALTA", r:4,p:3,d:4, cause:"Uscita celle -20¬∞C‚Üí+30¬∞C", danno:"Vasocostrizione shock", prevenzione:"Vestiaire termico", protezione:"Calzature termiche", normativa:"UNI EN 511"}
                ]
            },
            8: {
                title: "üß† RISCHI PSICOSOCIALI/NOT TURNO", count: 5,
                risks: [
                    {id:"RP1", title:"Turni notturni 22-6 perturbazione circadiana", matrix:"ALTA", r:4,p:4,d:4, cause:"Sonno <6h", danno:"Errori 30% + incidenti", prevenzione:"Pausa 11h tra turni", protezione:"Occhiali blu-block", normativa:"CCNL Logistica"},
                    {id:"RP2", title:"Stress picking target 120 colli/h", matrix:"MEDIA", r:3,p:5,d:4, cause:"Premi variabili", danno:"Burnout 25% turnover", prevenzione:"Rotazione mansioni", protezione:"Supporto psicologico", normativa:"D.Lgs.81/08 Tit.VI"},
                    {id:"RP3", title:"Conflitti gerarchici capimagazzino", matrix:"MEDIA", r:3,p:4,d:3, cause:"Obiettivi irrealistici", danno:"Ansia cronica", prevenzione:"Riunioni settimanali", protezione:"--, normativa:"ISO 45003:2021"},
                    {id:"RP4", title:"Isolamento lavoratore notturno", matrix:"ALTA", r:4,p:3,d:4, cause:"Comunicazione ridotta", danno:"Depressione stagionale", prevenzione:"Check-in radio orarie", protezione:"Linea ascolto 24h", normativa:"Patto territoriale"},
                    {id:"RP5", title:"Mobbing orizzontale gruppo", matrix:"MEDIA", r:3,p:3,d:4, cause:"Competizione premi", danno:"Bassa performance 20%", prevenzione:"Team building mensile", protezione:"Anonimizzazione reclami", normativa:"Legge 300/70"}
                ]
            }
        };

        // === RENDER CATEGORIE ===
        function renderCategories() {
            const container = document.getElementById('categories-container');
            container.innerHTML = '';
            
            Object.entries(RISKS_DB).forEach(([key, category]) => {
                const categoryCard = document.createElement('div');
                categoryCard.className = 'glass-panel p-6 md:p-8 rounded-2xl shadow-pro risk-card cursor-pointer hover:-translate-y-2 group';
                categoryCard.setAttribute('role', 'button');
                categoryCard.setAttribute('tabindex', '0');
                categoryCard.onclick = () => renderRisks(key);
                categoryCard.onkeydown = (e) => { if (e.key === 'Enter' || e.key === ' ') renderRisks(key); };
                
                categoryCard.innerHTML = `
                    <div class="flex items-center justify-between mb-6">
                        <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center text-2xl font-bold shadow-xl group-hover:scale-110 transition-transform">
                            ${getEmoji(key)}
                        </div>
                        <div class="text-right">
                            <div class="text-3xl font-black text-white mb-1">${category.count}</div>
                            <div class="text-indigo-300 text-sm font-medium">RISCHI</div>
                        </div>
                    </div>
                    <h3 class="text-xl md:text-2xl font-black mb-4 text-white leading-tight">${category.title}</h3>
                    <div class="flex items-center text-indigo-300 space-x-4 text-sm">
                        <span>üëÜ Clicca per dettagli</span>
                        <span class="w-6 h-6 bg-indigo-500 rounded-full flex items-center justify-center text-xs font-bold group-hover:bg-indigo-400 transition-colors">‚ñ∂</span>
                    </div>
                `;
                container.appendChild(categoryCard);
            });
        }

        function getEmoji(key) {
            const emojis = {1:'üîß',2:'üßç‚Äç‚ôÇÔ∏è',3:'‚ò£Ô∏è',4:'üå°Ô∏è',5:'üöú',6:'üî•',7:'üå°Ô∏è',8:'üß†'};
            return emojis[key] || '‚ö†Ô∏è';
        }

        // === RENDER SINGOLI RISCHI ===
        function renderRisks(categoryId) {
            const category = RISKS_DB[categoryId];
            const container = document.getElementById('categories-container');
            container.innerHTML = `
                <div class="col-span-full">
                    <div class="glass-panel p-8 md:p-12 rounded-3xl shadow-pro mb-8">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                            <div class="flex items-center space-x-4 mb-6 md:mb-0">
                                <div class="w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl flex items-center justify-center text-3xl font-bold shadow-2xl">${getEmoji(categoryId)}</div>
                                <div>
                                    <h2 class="text-3xl md:text-4xl font-black">${category.title}</h2>
                                    <p class="text-xl text-indigo-300">${category.count} rischi identificati</p>
                                </div>
                            </div>
                            <button onclick="renderCategories()" class="px-6 py-2.5 bg-gray-700 hover:bg-gray-600 rounded-xl font-semibold shadow-lg transition-all md:ml-8" aria-label="Torna alle categorie">
                                ‚Üê Torna indietro
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="risks-grid"></div>
                </div>
            `;
            
            const risksGrid = document.getElementById('risks-grid');
            category.risks.forEach(risk => {
                const riskCard = document.createElement('div');
                riskCard.className = `glass-panel p-6 md:p-8 rounded-2xl shadow-pro risk-card hover:border-l-indigo-400 ${getMatrixClass(risk.matrix)}`;
                riskCard.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h4 class="font-bold text-xl md:text-2xl">${risk.title}</h4>
                        <div class="px-4 py-2 rounded-xl font-bold text-white shadow-lg ${getMatrixClass(risk.matrix)}">
                            ${risk.matrix}
                        </div>
                    </div>
                    <div class="space-y-3 text-sm">
                        <div><span class="font-semibold text-indigo-300">Rischio:</span> ${risk.r}/5 | <span class="font-semibold text-indigo-300">Probabilit√†:</span> ${risk.p}/5 | <span class="font-semibold text-indigo-300">Danno:</span> ${risk.d}/5</div>
                        <div><span class="font-semibold text-orange-300">Cause:</span> ${risk.cause}</div>
                        <div><span class="font-semibold text-red-300">Danno:</span> ${risk.danno}</div>
                        <div><span class="font-semibold text-green-300">Prevenzione:</span> ${risk.prevenzione}</div>
                        <div><span class="font-semibold text-blue-300">Protezione:</span> ${risk.protezione}</div>
                        <div class="pt-3 border-t border-gray-600">
                            <span class="text-xs bg-gray-700 px-3 py-1 rounded-full font-semibold">${risk.normativa}</span>
                        </div>
                    </div>
                `;
                risksGrid.appendChild(riskCard);
            });
        }

        function getMatrixClass(matrix) {
            const classes = {
                'CRITICA': 'matrix-crit border-l-red-500',
                'ALTA': 'matrix-alta border-l-amber-500',
                'MEDIA': 'matrix-media border-l-yellow-500',
                'BASSA': 'matrix-bassa border-l-emerald-500'
            };
            return classes[matrix] || 'bg-gray-600 border-l-gray-500';
        }

        // === TEST 20 DOMANDE ===
        const QUIZ_QUESTIONS = [
            {q: "Quale normativa regola DVR?", a: ["D.Lgs 81/2008", "D.Lgs 626/94", "D.Lgs 195/06", "D.Lgs 106/09"], c: 0},
            {q: "Rischio CRITICO ha R/PD:", a: ["5/5/5", "3/4/4", "2/3/3", "4/2/4"], c: 0},
            {q: "Transpallet max kg senza formazione:", a: ["25kg", "50kg", "100kg", "1500kg"], c: 0},
            {q: "Protezione taglio nastri:", a: ["Guanti cut5", "Guanti nitrile", "Guanti lattice", "No guanti"], c: 0},
            {q: "Illuminamento minimo scaffali:", a: ["200lux", "500lux", "100lux", "1000lux"], c: 0},
            {q: "Rumore soglia azione dB(A):", a: ["85", "80", "90", "88"], c: 0},
            {q: "Mascherina polveri legno:", a: ["FFP3", "FFP2", "FFP1", "Chirurgica"], c: 0},
            {q: "Scala magazzino normativa:", a: ["EN131", "EN1004", "EN14183", "ISO1128"], c: 0},
            {q: "CO soglia allarme ppm:", a: ["30", "50", "100", "200"], c: 0},
            {q: "Corsie carrelli min larghezza:", a: ["3m", "2m", "4m", "2.5m"], c: 0},
            {q: "Formaldeide classificazione:", a: ["H330", "H314", "H302", "H361"], c: 0},
            {q: "Vibrazioni WBV soglia:", a: ["1.4m/s¬≤", "0.5m/s¬≤", "2m/s¬≤", "0.8m/s¬≤"], c: 0},
            {q: "Estintore pallet legno:", a: ["Polvere 6kg", "CO2", "Acqua", "Schiuma"], c: 0},
            {q: "WBGT caldo > soglia:", a: ["28¬∞C", "26¬∞C", "30¬∞C", "25¬∞C"], c: 0},
            {q: "Turni notturni max consecutive:", a: ["5", "7", "3", "10"], c: 0},
            {q: "Occhiali da lavoro:", a: ["Panoramica", "Correzione laser", "Sport", "Sole"], c: 0},
            {q: "Casco carichi sospesi:", a: ["Classe E", "Classe B", "Classe A", "Classe C"], c: 0},
            {q: "Picking ergonomico max colli/h:", a: ["80", "120", "150", "60"], c: 0},
            {q: "GPL nube esplosiva %:", a: ["4.4%", "9.5%", "2.1%", "12%"], c: 0},
            {q: "Amianto manipolazione:", a: ["Vietata", "FFP2", "Guanti", "Aspirazione"], c: 0}
        ];

        let currentQuestion = 0;
        let score = 0;
        let answers = [];

        function startTest() {
            document.getElementById('test-section').classList.remove('hidden');
            document.getElementById('categories-container').style.display = 'none';
            currentQuestion = 0;
            score = 0;
            answers = [];
            renderQuestion();
        }

        function renderQuestion() {
            const q = QUIZ_QUESTIONS[currentQuestion];
            const container = document.getElementById('quiz-container');
            container.innerHTML = `
                <div class="glass-panel p-8 rounded-2xl mb-8">
                    <div class="flex justify-between items-center mb-8">
                        <div class="text-2xl font-bold">Q${currentQuestion + 1}/20</div>
                        <div class="text-xl font-black text-indigo-400">${score}/${currentQuestion}</div>
                    </div>
                    <h3 class="text-2xl font-bold mb-8 text-center">${q.q}</h3>
                    <div class="space-y-4">
                        ${q.a.map((opt, i) => `
                            <button onclick="selectAnswer(${i})" class="w-full glass-panel p-6 rounded-xl hover:bg-indigo-600 hover:border-indigo-400 border-2 border-transparent transition-all text-left shadow-md hover:shadow-lg" role="radio" aria-checked="false">
                                <span class="font-semibold">${String.fromCharCode(65 + i)}.</span> ${opt}
                            </button>
                        `).join('')}
                    </div>
                    <div class="flex justify-between mt-12 pt-8 border-t border-gray-600">
                        ${currentQuestion > 0 ? `<button onclick="prevQuestion()" class="px-6 py-2 bg-gray-600 hover:bg-gray-500 rounded-xl">‚Üê Precedente</button>` : ''}
                        <button onclick="nextQuestion()" class="px-8 py-3 bg-indigo-500 hover:bg-indigo-600 rounded-xl font-semibold shadow-lg ml-auto">
                            ${currentQuestion < 19 ? 'Avanti ‚Üí' : 'üéØ Completa Test'}
                        </button>
                    </div>
                </div>
            `;
        }

        function selectAnswer(index) {
            answers[currentQuestion] = index;
            const buttons = document.querySelectorAll('[role="radio"]');
            buttons.forEach((btn, i) => {
                btn.setAttribute('aria-checked', i === index);
                if (i === index) {
                    btn.classList.add('bg-indigo-500', 'border-indigo-400');
                } else {
                    btn.classList.remove('bg-indigo-500', 'border-indigo-400');
                }
            });
        }

        function nextQuestion() {
            if (answers[currentQuestion] !== undefined) {
                if (answers[currentQuestion] === QUIZ_QUESTIONS[currentQuestion].c) score++;
                if (currentQuestion < 19) {
                    currentQuestion++;
                    renderQuestion();
                } else {
                    showResults();
                }
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
            }
        }

        function showResults() {
            const percentage = Math.round((score / 20) * 100);
            const passed = percentage >= 70;
            
            document.getElementById('quiz-container').innerHTML = '';
            document.getElementById('test-section').classList.add('hidden');
            document.getElementById('results-section').classList.remove('hidden');
            
            const badge = document.getElementById('results-badge');
            const title = document.getElementById('results-title');
            const scoreEl = document.getElementById('results-score');
            
            if (passed) {
                badge.innerHTML = '<div class="bg-gradient-to-r from-emerald-500 to-teal-600 px-12 py-8 rounded-3xl shadow-2xl"><span class="text-6xl">üèÜ</span></div>';
                title.textContent = 'TEST SUPERATO!';
                scoreEl.textContent = `${percentage}%`;
                scoreEl.className = 'text-5xl font-black mb-8 text-emerald-400';
            } else {
                badge.innerHTML = '<div class="bg-gradient-to-r from-orange-500 to-red-500 px-12 py-8 rounded-3xl shadow-2xl"><span class="text-6xl">üìö</span></div>';
                title.textContent = 'RIFAI IL TEST!';
                scoreEl.textContent = `${percentage}%`;
                scoreEl.className = 'text-5xl font-black mb-8 text-orange-400';
            }
        }

        function closeTest() {
            document.getElementById('test-section').classList.add('hidden');
            document.getElementById('results-section').classList.add('hidden');
            document.getElementById('categories-container').style.display = 'grid';
            renderCategories();
        }

        // === UTILITY ===
        function exportCertificate() {
            const percentage = Math.round((score / 20) * 100);
            html2canvas(document.body).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                pdf.setFontSize(20);
                pdf.setTextColor(0, 100, 200);
                pdf.text('CERTIFICATO CONOSCENZE DVR MAGAZZINO', 105, 30, { align: 'center' });
                pdf.setFontSize(12);
                pdf.text(`Punteggio ottenuto: ${percentage}%`, 105, 60, { align: 'center' });
                pdf.text('Dott. Salvatore Trono - Consulente SPP', 105, 80, { align: 'center' });
                pdf.text(`Data: ${new Date().toLocaleDateString('it-IT')}`, 105, 90, { align: 'center' });
                
                pdf.addImage(imgData, 'PNG', 10, 100, 190, 180);
                pdf.save(`Certificato-DVR-${percentage}%-${Date.now()}.pdf`);
            });
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        }

        // === INIT ===
        document.addEventListener('DOMContentLoaded', () => {
            renderCategories();
            
            if (localStorage.getItem('theme') === 'light') {
                toggleTheme();
            }

            // Keyboard navigation
            document.addEventListener('keydown', e => {
                if (e.key === 'Escape') {
                    closeTest();
                    renderCategories();
                }
            });

            // Init PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('data:text/javascript;base64,...');
            }
        });

        function exportPDF() {
            html2canvas(document.body, { 
                scale: 2, 
                useCORS: true,
                backgroundColor: '#0f172a',
                logging: false
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                pdf.save('DVR-Magazziniere-Completo-52-Rischi-Dott-Salvatore-Trono.pdf');
            });
        }
    </script>
</body>
</html>
