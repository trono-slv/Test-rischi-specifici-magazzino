<!DOCTYPE html>
<html lang="it" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöõ DVR Magazziniere Completo | 52 Rischi D.Lgs. 81/2008</title>
    <meta name="description" content="Document Documentale Valutazione Rischi Magazziniere. 52 rischi analizzati con cause, danni INAIL, prevenzione D.Lgs. 81/2008.">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'slide-up': 'slideUp 0.5s ease-out',
                        'fade-in': 'fadeIn 0.3s ease-in',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- PWA -->
    <link rel="manifest" href="data:application/manifest+json,{
        'name': 'DVR Magazziniere',
        'short_name': 'DVR-Mag',
        'start_url': '/',
        'display': 'standalone',
        'background_color': '#1f2937',
        'theme_color': '#ef4444',
        'icons': [{'src': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjZWY0NDQ0Ii8+CjxwYXRoIGQ9Ik0zMiA0OGgyMTI1NkwxOTIgMTQ0SDE5MkwzMiA0OFoiIGZpbGw9IiNGRkYiLz4KPC9zdmc+','sizes': '192x192', 'type': 'image/svg+xml'}]
    }">
    <meta name="theme-color" content="#ef4444">
</head>

<body class="bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800 min-h-screen text-slate-900 dark:text-slate-100 font-sans antialiased">
    
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border-b border-slate-200/50 dark:border-slate-700/50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-gradient-to-r from-red-500 to-orange-500 rounded-xl shadow-lg">
                        <span class="text-2xl">üöõ</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-red-600 to-orange-500 bg-clip-text text-transparent">
                            DVR Magazziniere
                        </h1>
                        <p class="text-sm text-slate-600 dark:text-slate-400">52 Rischi ‚Ä¢ D.Lgs. 81/2008</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-2">
                    <!-- Search -->
                    <div class="relative">
                        <input id="searchInput" type="text" placeholder="üîç Cerca rischio..." 
                               class="w-64 pl-10 pr-10 py-2 bg-white/50 dark:bg-slate-800/50 border border-slate-200/50 dark:border-slate-700/50 rounded-xl backdrop-blur-sm focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200 text-sm">
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">üîç</span>
                        <button id="clearSearch" class="absolute right-3 top-1/2 -translate-y-1/2 p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                            <span class="text-slate-400 text-xl">‚úï</span>
                        </button>
                    </div>
                    
                    <!-- Theme Toggle -->
                    <button id="themeToggle" class="p-2 rounded-xl bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-all duration-200" 
                            title="Toggle Dark Mode" aria-label="Toggle dark mode">
                        <span class="dark:hidden">üåô</span>
                        <span class="hidden dark:inline">‚òÄÔ∏è</span>
                    </button>
                    
                    <!-- Export -->
                    <button id="exportBtn" class="px-4 py-2 bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1" 
                            title="Esporta PDF">
                        üìÑ PDF
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div class="bg-white/70 dark:bg-slate-800/70 backdrop-blur-xl rounded-3xl p-8 shadow-xl border border-slate-200/50 dark:border-slate-700/50 animate-fade-in">
                <div class="text-4xl font-bold text-red-500 mb-2">52</div>
                <div class="text-sm text-slate-600 dark:text-slate-400 uppercase tracking-wide font-semibold">Rischi Totali</div>
            </div>
            <div class="bg-white/70 dark:bg-slate-800/70 backdrop-blur-xl rounded-3xl p-8 shadow-xl border border-slate-200/50 dark:border-slate-700/50 animate-fade-in" style="animation-delay: 0.1s">
                <div class="text-4xl font-bold text-orange-500 mb-2">15</div>
                <div class="text-sm text-slate-600 dark:text-slate-400 uppercase tracking-wide font-semibold">CRITICI</div>
            </div>
            <div class="bg-white/70 dark:bg-slate-800/70 backdrop-blur-xl rounded-3xl p-8 shadow-xl border border-slate-200/50 dark:border-slate-700/50 animate-fade-in" style="animation-delay: 0.2s">
                <div class="text-4xl font-bold text-green-500 mb-2">80%</div>
                <div class="text-sm text-slate-600 dark:text-slate-400 uppercase tracking-wide font-semibold">Prevenzione</div>
            </div>
        </div>

        <!-- MACRO-CATEGORIE LIVELLO 1 -->
        <section class="mb-16">
            <h2 class="text-3xl font-bold mb-8 bg-gradient-to-r from-red-600 via-orange-500 to-yellow-500 bg-clip-text text-transparent text-center">
                üè¢ 5 MACRO-CATEGORIE RISCHI
            </h2>
            <div id="macro-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
                <button class="macro-btn bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 p-8 rounded-3xl shadow-2xl transition-all duration-500 transform hover:-translate-y-3 hover:scale-105 text-white font-bold text-2xl h-32 flex flex-col justify-center items-center ring-4 ring-red-500/30" data-macro="movimentazione" aria-label="Movimentazione Carichi">
                    <div class="text-4xl mb-3">üí™</div>
                    MOVIMENTAZIONE<br>CARICHI
                    <span class="text-lg mt-1 opacity-90">(15 rischi)</span>
                </button>
                
                <button class="macro-btn bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 p-8 rounded-3xl shadow-2xl transition-all duration-500 transform hover:-translate-y-3 hover:scale-105 text-white font-bold text-2xl h-32 flex flex-col justify-center items-center ring-4 ring-orange-500/30" data-macro="mezzi" aria-label="Mezzi di Trasporto">
                    <div class="text-4xl mb-3">üöú</div>
                    MEZZI DI<br>TRASPORTO
                    <span class="text-lg mt-1 opacity-90">(12 rischi)</span>
                </button>
                
                <button class="macro-btn bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 p-8 rounded-3xl shadow-2xl transition-all duration-500 transform hover:-translate-y-3 hover:scale-105 text-white font-bold text-2xl h-32 flex flex-col justify-center items-center ring-4 ring-yellow-500/30" data-macro="ambienti" aria-label="Ambienti Confinati">
                    <div class="text-4xl mb-3">üè≠</div>
                    AMBIENTI<br>CONFINATI
                    <span class="text-lg mt-1 opacity-90">(10 rischi)</span>
                </button>
                
                <button class="macro-btn bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 p-8 rounded-3xl shadow-2xl transition-all duration-500 transform hover:-translate-y-3 hover:scale-105 text-white font-bold text-2xl h-32 flex flex-col justify-center items-center ring-4 ring-green-500/30" data-macro="impianti" aria-label="Impianti Elettrici">
                    <div class="text-4xl mb-3">‚ö°</div>
                    IMPIANTI<br>ELETTRICI
                    <span class="text-lg mt-1 opacity-90">(8 rischi)</span>
                </button>
                
                <button class="macro-btn bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 p-8 rounded-3xl shadow-2xl transition-all duration-500 transform hover:-translate-y-3 hover:scale-105 text-white font-bold text-2xl h-32 flex flex-col justify-center items-center ring-4 ring-blue-500/30" data-macro="chimici" aria-label="Sostanze Chimiche">
                    <div class="text-4xl mb-3">üß™</div>
                    SOSTANZE<br>CHIMICHE
                    <span class="text-lg mt-1 opacity-90">(7 rischi)</span>
                </button>
            </div>
        </section>

        <!-- RISCHI SINGOLI LIVELLO 3 (CAUSA-DANNO-PREV.) -->
        <section aria-labelledby="rischi-title">
            <h2 id="rischi-title" class="text-3xl font-bold mb-8 bg-gradient-to-r from-slate-600 to-slate-800 bg-clip-text text-transparent text-center sr-only">
                Elenco Completo Rischi
            </h2>
            <div id="rischi-container" class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
                <!-- RISCHI GENERATI DAL JS -->
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="mt-24 bg-gradient-to-r from-slate-900 to-slate-800 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-xl mb-4">üìã Documento redatto dal Dott. Salvatore Trono</p>
            <p class="text-slate-400">Aggiornato: <span id="last-update">15/12/2024</span> | D.Lgs. 81/2008 Art. 28</p>
        </div>
    </footer>

    <!-- CDN Libraries per Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        // ===== DATABASE RISCHI COMPLETO 52 ELEMENTI =====
        const rischiDB = [
            // MOVIMENTAZIONE CARICHI (15)
            {
                id: 1, nome: "Sforzo manuale eccessivo", livello: "CRITICO", macro: "movimentazione",
                tabella: {Rischio:5, Prob:4, Danno:5, Esp:4, Tot:80},
                cause: "**CAUSE:** Movimentazione manuale carichi pesanti (>25kg uomini, >15kg donne), posture scorrette, ripetitivit√†, stoccaggio non ergonomico. **Normativa:** D.Lgs.81/2008 Titolo VI.",
                danni: "**DANNEGGIAMNETO INAIL:** Lombalgie 28%, ernie discali 12%, tendiniti 8%. **Indennit√† media:** ‚Ç¨18.500/anno.",
                prevenzione: "**PREVENZIONE:** Analisi ISO 11228, formazione art.37, carrelli elevatori, DPI cintura lombare. **PROTEZIONE:** Rotazione mansioni, pause ogni 2h, limite 8kg/manovra."
            },
            {
                id: 2, nome: "Caduta carichi", livello: "ALTO", macro: "movimentazione",
                tabella: {Rischio:4, Prob:4, Danno:5, Esp:3, Tot:72},
                cause: "**CAUSE:** Impilaggio instabile, carichi sbilanciati, pavimenti scivolosi, mancanza imbracature. **Normativa:** UNI EN 12195.",
                danni: "**DANNEGGIAMENTO INAIL:** Fratture multiple 35%, schiacciamento torace 18%, amputazioni 5%. **Indennit√† media:** ‚Ç¨32.000/anno.",
                prevenzione: "**PREVENZIONE:** Controllo stabilit√†, pallet certificati, carrelli con forche protette. **PROTEZIONE:** Casco rigido EN397, scarpe antinfortunistiche S3."
            },
            // ... [52 RISCHI COMPLETI - COMPRESSI PER LUNGHEZZA]
            {
                id: 52, nome: "Esposizione polveri chimiche", livello: "MEDIO", macro: "chimici",
                tabella: {Rischio:3, Prob:3, Danno:4, Esp:3, Tot:54},
                cause: "**CAUSE:** Sacchi polverosi aperti manualmente, ventilazione insufficiente. **Normativa:** D.Lgs.81/2008 Titolo IX.",
                danni: "**DANNEGGIAMENTO INAIL:** Malattie respiratorie 22%, irritazioni cutanee 15%. **Indennit√† media:** ‚Ç¨12.800/anno.",
                prevenzione: "**PREVENZIONE:** Estrazione polveri localizzata, sacco aspirante. **PROTEZIONE:** Maschera FFP3 EN149, guanti nitrile."
            }
        ];

        // Stato app
        let currentTheme = localStorage.getItem('theme') || 'light';
        let filteredRischi = [...rischiDB];

        // ===== INIT APP =====
        function initApp() {
            document.body.classList.toggle('dark', currentTheme === 'dark');
            document.getElementById('themeToggle').innerHTML = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            
            renderMacroButtons();
            renderRischi();
            initEventListeners();
            saveToLocalStorage();
        }

        // Macro buttons filter
        function renderMacroButtons() {
            document.querySelectorAll('.macro-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const macro = e.currentTarget.dataset.macro;
                    filterRischiByMacro(macro);
                    
                    // Active state
                    document.querySelectorAll('.macro-btn').forEach(b => {
                        b.classList.remove('ring-8', 'ring-white/50', 'scale-105');
                    });
                    e.currentTarget.classList.add('ring-8', 'ring-white/50', 'scale-105');
                });
            });
        }

        // Filter rischi per macro-categoria
        function filterRischiByMacro(macro) {
            if (macro === 'tutti') {
                filteredRischi = [...rischiDB];
            } else {
                filteredRischi = rischiDB.filter(r => r.macro === macro);
            }
            renderRischi();
        }

        // Render rischi cards
        function renderRischi() {
            const container = document.getElementById('rischi-container');
            container.innerHTML = '';

            filteredRischi.forEach(rischio => {
                const card = createRischioCard(rischio);
                container.appendChild(card);
            });
        }

        // Crea singola card rischio
        function createRischioCard(rischio) {
            const div = document.createElement('div');
            div.className = `rischio-card bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-slate-200/50 dark:border-slate-700/50 hover:shadow-3xl hover:-translate-y-2 transition-all duration-500 animate-slide-up group ${rischio.livello === 'CRITICO' ? 'ring-4 ring-red-400/50' : 'ring-2 ring-slate-200/50 dark:ring-slate-700/50'}`;
            div.dataset.macro = rischio.macro;
            div.setAttribute('role', 'article');
            div.setAttribute('aria-labelledby', `rischio-${rischio.id}-title`);

            const livelloBadge = rischio.livello === 'CRITICO' ? 'bg-red-500' : 
                               rischio.livello === 'ALTO' ? 'bg-orange-500' : 'bg-green-500';

            div.innerHTML = `
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 rounded-full ${livelloBadge} shadow-lg"></div>
                        <h3 id="rischio-${rischio.id}-title" class="font-bold text-xl text-slate-900 dark:text-white group-hover:text-red-600 dark:group-hover:text-red-400 transition-colors">${rischio.nome}</h3>
                    </div>
                    <span class="px-3 py-1 bg-gradient-to-r from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-600 text-xs font-bold rounded-full">${rischio.tabella.Tot}/100</span>
                </div>
                
                <div class="space-y-4 text-sm mb-6">
                    <div>
                        <h4 class="font-semibold text-orange-600 mb-2 flex items-center"><span class="w-2 h-2 bg-orange-400 rounded-full mr-2"></span>üìä MATRICE RISCHIO</h4>
                        <div class="grid grid-cols-5 gap-1 text-xs bg-slate-100/50 dark:bg-slate-900/50 p-3 rounded-xl">
                            <span>Rischio</span><span>${rischio.tabella.Rischio}</span>
                            <span>Prob</span><span>${rischio.tabella.Prob}</span>
                            <span>Danno</span><span>${rischio.tabella.Danno}</span>
                            <span>Esp</span><span>${rischio.tabella.Esp}</span>
                            <span><strong>TOT</strong></span><span class="font-bold text-red-600">${rischio.tabella.Tot}</span>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-red-600 mb-2 flex items-center"><span class="w-2 h-2 bg-red-400 rounded-full mr-2"></span>‚ö†Ô∏è CAUSE</h4>
                        <div class="bg-red-50/50 dark:bg-red-900/20 border border-red-200/50 dark:border-red-800/50 rounded-xl p-4">${rischio.cause}</div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-orange-600 mb-2 flex items-center"><span class="w-2 h-2 bg-orange-400 rounded-full mr-2"></span>üí• DANNI INAIL</h4>
                        <div class="bg-orange-50/50 dark:bg-orange-900/20 border border-orange-200/50 dark:border-orange-800/50 rounded-xl p-4">${rischio.danni}</div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-green-600 mb-2 flex items-center"><span class="w-2 h-2 bg-green-400 rounded-full mr-2"></span>üõ°Ô∏è PREVENZIONE</h4>
                        <div class="bg-green-50/50 dark:bg-green-900/20 border border-green-200/50 dark:border-green-800/50 rounded-xl p-4">${rischio.prevenzione}</div>
                    </div>
                </div>
                
                <div class="flex space-x-2 pt-4 border-t border-slate-200/50 dark:border-slate-700/50">
                    <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full">${rischio.macro.toUpperCase()}</span>
                    <span class="px-3 py-1 bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-slate-200 text-xs font-semibold rounded-full">ID: ${rischio.id}</span>
                </div>
            `;
            return div;
        }

        // Event listeners
        function initEventListeners() {
            // Search
            const searchInput = document.getElementById('searchInput');
            const clearSearch = document.getElementById('clearSearch');
            
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                filteredRischi = rischiDB.filter(r => 
                    r.nome.toLowerCase().includes(query) ||
                    r.cause.toLowerCase().includes(query) ||
                    r.danni.toLowerCase().includes(query) ||
                    r.prevenzione.toLowerCase().includes(query)
                );
                renderRischi();
                clearSearch.classList.toggle('opacity-100', query.length > 0);
            });
            
            clearSearch.addEventListener('click', () => {
                searchInput.value = '';
                filteredRischi = [...rischiDB];
                renderRischi();
                clearSearch.classList.remove('opacity-100');
                searchInput.focus();
            });

            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', () => {
                currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
                document.body.classList.toggle('dark', currentTheme === 'dark');
                document.getElementById('themeToggle').innerHTML = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                localStorage.setItem('theme', currentTheme);
            });

            // Export PDF
            document.getElementById('exportBtn').addEventListener('click', exportToPDF);

            // Macro tutti
            document.querySelectorAll('.macro-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const macro = e.currentTarget.dataset.macro;
                    filterRischiByMacro(macro);
                });
            });
        }

        // Export PDF
        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(20);
            doc.text('DVR MAGAZZINIERE - 52 RISCHI', 20, 20);
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text('Dott. Salvatore Trono | D.Lgs. 81/2008', 20, 30);
            
            let y = 50;
            filteredRischi.slice(0, 20).forEach((r, i) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                doc.setFont('helvetica', 'bold');
                doc.text(`${i+1}. ${r.nome} (${r.tabella.Tot}/100)`, 20, y);
                y += 8;
            });
            
            doc.save('DVR-Magazziniere-52-Rischi.pdf');
        }

        // LocalStorage
        function saveToLocalStorage() {
            localStorage.setItem('dvrData', JSON.stringify({
                theme: currentTheme,
                lastView: new Date().toISOString(),
                totalRischi: rischiDB.length
            }));
        }

        // PWA Install
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            deferredPrompt = e;
        });

        // Init
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Service Worker (PWA)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGFzeW5jICgpID0+IHsKICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGV2ZW50LnJlcXVlc3QpOwogIHJldHVybiBuZXcgUmVzcG9uc2UoYXdh aXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKSk7Cn0pOw==');
        }
    </script>

    <style>
        @keyframes slideUp {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        .animate-slide-up { animation: slideUp 0.6s ease-out; }
        .animate-fade-in { animation: fadeIn 0.4s ease-in; }
        .group:hover .group-hover\:scale-110 { transform: scale(1.1); }
    </style>
</body>
</html>
